#!/usr/bin/env python
"""
Controller for various ports operations
"""
from make import pre_cmd
from port import ports, Port, port_filter
from queue import ports_queue

import make, port
make.pre_cmd = ['echo']
port.port_filter = Port.OLDER

ports.get('x11/xorg')
ports_queue.join()
print "Getting 'x11/xorg' dependant handler..."
ports['x11/xorg'].depends()

for name, port in ports.iteritems():
  print """
==============================================================================
Origin:      %s
------------------------------------------------------------------------------
Name:        %s
Version:     %s
Revision:    %s
Comment:     ``%s''
Dependants:  %s
Depend stat: %i
""" % (name, port.attr('name'), port.attr('version'), port.attr('revision'),
       port.attr('comment'), port.depends().dependants(fields=True),
       port.depends().status())

print len(ports)
configs = filter(lambda x: x.stage() < Port.CONFIG, ports.itervalues())
while len(configs):
  for i in configs:
    i.config()
  ports_queue.join()
  print len(ports)
  configs = filter(lambda x: x.stage() < Port.CONFIG, ports.itervalues())

print ports_queue.stats(), len(ports)
